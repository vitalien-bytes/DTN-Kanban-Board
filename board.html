<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="style.css"/>
  <title>Board Clients :contentReference[oaicite:1]{index=1}</title>
</head>
<body>

<header class="board-header">
  <h1>Board Clients :contentReference[oaicite:2]{index=2}</h1>
  <button class="logout-btn" onclick="logout()">DÃ©connexion</button>
</header>

<div class="board-container">

  <!-- COLONNES -->
  <div class="column" data-key="todo">
    <h2>Ã€ faire</h2>
    <button class="add-btn" onclick="createCard('todo')">+ Nouveau Client</button>
    <div class="cards"></div>
  </div>

  <div class="column" data-key="doing">
    <h2>En cours</h2>
    <div class="cards"></div>
  </div>

  <div class="column" data-key="done">
    <h2>TerminÃ©</h2>
    <div class="cards"></div>
  </div>

</div>

<!-- EXPORT JSON -->
<div class="export-bar">
  <button onclick="exportData()">ğŸ’¾ TÃ©lÃ©charger board-data.json</button>
</div>

<script>
// ğŸ” Protection dâ€™accÃ¨s
if (localStorage.getItem("auth") !== "true") {
  document.body.innerHTML = "<h2>AccÃ¨s refusÃ© ğŸ”</h2>";
}

// ğŸ§  DonnÃ©es JSON (stockÃ©es en local)
let boardData = JSON.parse(localStorage.getItem("board-data") || '{"todo":[],"doing":[],"done":[]}');

function saveBoard() {
  localStorage.setItem("board-data", JSON.stringify(boardData));
}

// ğŸ´ CrÃ©ation d'une carte avec formulaire
function createCard(key) {
  const name = prompt("Nom du client :");
  const city = prompt("Ville / Commune :");
  const work = prompt("Type de travaux :");

  if (name && city && work) {
    const cardText = `ğŸ‘¤ ${name}\nğŸ“ ${city}\nğŸ›  ${work}`;
    boardData[key].push(cardText);
    saveBoard();
    renderBoard();
  }
}

// Drag & Drop
document.querySelectorAll(".column .cards").forEach(cardsContainer => {
  cardsContainer.ondragover = ev => ev.preventDefault();

  cardsContainer.ondrop = ev => {
    const card = ev.dataTransfer.getData("card");
    const fromKey = ev.dataTransfer.getData("from");
    const toKey = cardsContainer.parentElement.dataset.key;

    boardData[fromKey] = boardData[fromKey].filter(c => c !== card);
    boardData[toKey].push(card);
    saveBoard();
    renderBoard();
  }
});

// Affichage board
function renderBoard() {
  document.querySelectorAll(".column").forEach(col => {
    const key = col.dataset.key;
    const container = col.querySelector(".cards");
    container.innerHTML = "";

    boardData[key].forEach(card => {
      const div = document.createElement("div");
      div.className = "card";
      div.draggable = true;
      div.innerText = card;
      div.ondragstart = ev => {
        ev.dataTransfer.setData("card", card);
        ev.dataTransfer.setData("from", key);
      };
      container.appendChild(div);
    });
  });
}

// Export JSON
function exportData() {
  const blob = new Blob([JSON.stringify(boardData, null, 2)], { type: "application/json" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "board-data.json";
  a.click();
}

// DÃ©connexion
function logout() {
  localStorage.removeItem("auth");
  window.location.href = "index.html";
}

// 1er rendu
renderBoard();
</script>

</body>
</html>
