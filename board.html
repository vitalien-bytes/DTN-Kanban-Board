<!doctype html>
<html lang="fr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DTN SmartOps</title>
<link rel="stylesheet" href="style.css"/>
<style>
body{margin:0;font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI}
.topbar{display:flex;justify-content:space-between;align-items:center;padding:12px 20px;background:#1f1f1f;color:white}
.search-box input{padding:8px 12px;border-radius:8px;border:none;width:220px}
.actions button{margin-left:8px}
.board-container{display:flex;gap:18px;padding:16px;overflow-x:auto}
.column{background:#ebecf0;width:270px;padding:10px;border-radius:10px;flex-shrink:0;position:relative}
.column-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
.menu-btn{background:none;border:none;font-size:20px;cursor:pointer;padding:3px}
.menu-list{display:none;position:absolute;right:10px;top:40px;background:white;border-radius:6px;box-shadow:0 2px 8px rgba(0,0,0,.2);padding:6px;z-index:50}
.menu-list.open{display:block}
.menu-list button{background:none;border:none;padding:6px 10px;width:100%;text-align:left;cursor:pointer;font-size:14px}
.card{display:flex;align-items:center;gap:8px;background:white;padding:10px;border-radius:8px;font-weight:600;cursor:pointer;box-shadow:0 1px 3px rgba(0,0,0,.2);margin-bottom:8px}
.card:hover{background:#f8f8f8}
.card-type{width:6px;align-self:stretch;border-radius:4px}
.card.today{background:#fff7e0}
.card.overdue{background:#ffe5e5}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);justify-content:center;align-items:center}
.modal.open{display:flex}
.modal-card{background:white;padding:18px;border-radius:12px;width:340px;max-height:85vh;overflow-y:auto}
.modal-card label{font-size:13px;font-weight:600;display:block;margin-top:6px}
.modal-card input,.modal-card select,.modal-card textarea{width:100%;padding:6px 8px;margin-top:3px;border-radius:6px;border:1px solid #ccc;font-size:14px}
.btn{padding:6px 10px;border-radius:8px;border:none;cursor:pointer}
.btn-primary{background:#6c5ce7;color:#fff}
.btn-accent{background:#00b894;color:#fff}
.timeline-item{display:flex;gap:12px;margin-bottom:16px}
.timeline-icon{font-size:20px;width:30px;text-align:center}
.timeline-content{background:#f5f5f5;padding:10px 12px;border-radius:6px;flex:1;font-size:14px}
.timeline-date{font-size:12px;color:#777;margin-top:4px}
</style>
</head>
<body>
<header class="topbar">
  <div class="brand">
    <span style="font-size:20px;"><b>DTN</b> SmartOps</span>
  </div>
  <div class="search-box">
    <input type="text" id="searchInput" placeholder="Rechercher un client‚Ä¶" oninput="filterCards()">
  </div>
  <div class="actions">
    <button onclick="openClientModal()" class="btn btn-primary">+ Nouveau client</button>
    <button onclick="addColumn()" class="btn btn-accent">‚ûï Colonne</button>
    <button onclick="exportBoard()" class="btn btn-accent">‚¨á Export</button>
    <button onclick="importBoard()" class="btn btn-accent">‚¨Ü Import</button>
    <input type="file" id="importFile" style="display:none" onchange="loadBoardFile(this)">
  </div>
</header>
<main id="kanban-board" class="board-container"></main>
<div id="clientModal" class="modal">
  <div class="modal-card">
    <h3>Nouveau client</h3>
    <form onsubmit="createClient(event)">
      <label>Nom<input id="lastname" required></label>
      <label>Pr√©nom<input id="firstname" required></label>
      <label>T√©l√©phone<input id="tel"></label>
      <label>Adresse<input id="address"></label>
      <label>Email<input id="email"></label>
      <label>Type de chantier<select id="work"><option>Fibre / T√©l√©com</option><option>√âlectricit√©</option><option>IRVE</option><option>Photovolta√Øque</option><option>Terrassement</option><option>D√©tection r√©seaux</option><option>Autres</option></select></label>
      <label>Commentaire<textarea id="comment" rows="3"></textarea></label>
      <div style="margin-top:10px;display:flex;gap:10px;justify-content:flex-end;">
        <button type="button" onclick="closeClientModal()" class="btn">Annuler</button>
        <button type="submit" class="btn btn-primary">Ajouter</button>
      </div>
    </form>
  </div>
</div>
<div id="sheetModal" class="modal">
  <div class="modal-card" style="width:380px;">
    <h3>Fiche client</h3>
    <label>Nom<input id="sheet-lastname"></label>
    <label>Pr√©nom<input id="sheet-firstname"></label>
    <label>T√©l√©phone<input id="sheet-tel"></label>
    <label>Adresse<input id="sheet-address"></label>
    <label>Email<input id="sheet-email"></label>
    <label>Type de chantier<select id="sheet-work"><option>Fibre / T√©l√©com</option><option>√âlectricit√©</option><option>IRVE</option><option>Photovolta√Øque</option><option>Terrassement</option><option>D√©tection r√©seaux</option><option>Autres</option></select></label>
    <label>Commentaire<textarea id="sheet-comment" rows="3"></textarea></label>
    <h4 style="margin-top:10px;">Intervention planifi√©e</h4>
    <label>Date<input type="date" id="sheet-int-date"></label>
    <label>Heure<input type="time" id="sheet-int-time"></label>
    <label>Technicien<input id="sheet-int-tech"></label>
    <label>Note intervention<textarea id="sheet-int-note" rows="2"></textarea></label>
    <div style="display:flex;gap:10px;margin-top:15px;flex-wrap:wrap;">
      <button onclick="editClient()" class="btn btn-primary" style="flex:1">üíæ Enregistrer</button>
      <button onclick="archiveClient()" class="btn btn-accent" style="flex:1">üì• Archiver</button>
    </div>
    <button onclick="closeSheet()" class="btn" style="margin-top:12px;width:100%">Fermer</button>
  </div>
</div>
<script>
let boardData = JSON.parse(localStorage.getItem("boardData")||"null");
if(!boardData){boardData={columns:[{id:"col-1",name:"√Ä faire",cards:[]},{id:"col-2",name:"En cours",cards:[]},{id:"col-3",name:"Termin√©",cards:[]},{id:"archives",name:"Archives",cards:[]}]};}
// ‚úÖ SAUVEGARDE AUTOMATIQUE + EXPORT DANS LE DOSSIER DRIVE SYNC
function saveBoard(){
  localStorage.setItem("boardData",JSON.stringify(boardData));
  const dataStr = JSON.stringify(boardData,null,2);
  const blob = new Blob([dataStr],{type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "board-data.json";
  a.style.display = "none";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}
function exportBoard(){saveBoard();}
function importBoard(){document.getElementById("importFile").click();}
function loadBoardFile(input){const file=input.files[0];if(!file)return;const reader=new FileReader();reader.onload=e=>{try{boardData=JSON.parse(e.target.result);saveBoard();renderBoard();alert("‚úÖ Donn√©es import√©es");}catch{alert("‚ùå Fichier invalide");}};reader.readAsText(file);}
function addColumn(){const name=prompt("Nom de la colonne ?");if(!name)return;boardData.columns.splice(boardData.columns.length-1,0,{id:"col-"+Date.now(),name,cards:[]});saveBoard();renderBoard();}
function openClientModal(colId=null){window.newClientTargetColumn=colId;document.getElementById("clientModal").classList.add("open");}
function closeClientModal(){document.getElementById("clientModal").classList.remove("open");}
function createClient(e){e.preventDefault();const colId=window.newClientTargetColumn||boardData.columns[0].id;const col=boardData.columns.find(c=>c.id===colId);const client={id:Date.now().toString(),lastname:lastname.value,firstname:firstname.value,tel:tel.value,address:address.value,email:email.value,work:work.value,comment:comment.value,intervention:null,history:[]};col.cards.push(client);saveBoard();closeClientModal();renderBoard();e.target.reset();}
function renderBoard(){const board=document.getElementById("kanban-board");board.innerHTML="";boardData.columns.forEach(col=>{const colDiv=document.createElement("div");colDiv.className="column";colDiv.innerHTML=`<div class='column-head'><strong>${col.name}</strong><button onclick="openClientModal('${col.id}')" class="menu-btn">‚ûï</button></div><div class="cards" id="cards-${col.id}"></div>`;board.appendChild(colDiv);const cardsDiv=document.getElementById(`cards-${col.id}`);col.cards.forEach((client,index)=>{const card=document.createElement("div");card.className="card";card.textContent=client.lastname+" "+client.firstname;card.onclick=()=>openSheet(client,col.id,index);cardsDiv.appendChild(card);});});}
let currentClient=null;
function openSheet(client,colId,index){currentClient={colId,index};sheet_lastname.value=client.lastname;sheet_firstname.value=client.firstname;document.getElementById("sheetModal").classList.add("open");}
function closeSheet(){document.getElementById("sheetModal").classList.remove("open");}
function editClient(){const {colId,index}=currentClient;const col=boardData.columns.find(c=>c.id===colId);const c=col.cards[index];c.lastname=sheet_lastname.value;c.firstname=sheet_firstname.value;saveBoard();renderBoard();closeSheet();}
function archiveClient(){const {colId,index}=currentClient;const fromCol=boardData.columns.find(c=>c.id===colId);const toCol=boardData.columns.find(c=>c.id==="archives");const client=fromCol.cards[index];fromCol.cards.splice(index,1);toCol.cards.push(client);saveBoard();renderBoard();closeSheet();}
function filterCards(){const q=searchInput.value.toLowerCase();document.querySelectorAll('.card').forEach(card=>{card.style.display=card.textContent.toLowerCase().includes(q)?"flex":"none";});}
renderBoard();
</script>
</body>
</html>
