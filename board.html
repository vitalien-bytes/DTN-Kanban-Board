<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Board - DTN SmartOps</title>
<link rel="stylesheet" href="style.css">
</head>
<body onload="loadBoard()">

<header>
  <h1>DTN SmartOps Board</h1>
  <button onclick="logout()">DÃ©connexion</button>
</header>

<main>
  <div id="board" class="kanban-board">
      <!-- Les colonnes seront gÃ©nÃ©rÃ©es ici -->
  </div>
</main>

<script>
const driveFileId = null; // placeholder si tu veux mettre plus tard
const driveDataUrl = null;

const columns = ["Ã€ faire", "En cours", "TerminÃ©"];

function loadBoard() {
  if (!sessionStorage.getItem("auth")) {
    window.location.href = "index.html";
  }

  const saved = localStorage.getItem("kanbanData");
  const data = saved ? JSON.parse(saved) : { cards: [] };

  const board = document.getElementById("board");
  board.innerHTML = "";

  columns.forEach(stage => {
    const col = document.createElement("div");
    col.className = "kanban-column";
    col.innerHTML = `<h3>${stage}</h3><div class="card-list" id="${stage}"></div>`;
    board.appendChild(col);
  });

  data.cards.forEach(card => {
    const cardEl = document.createElement("div");
    cardEl.className = "kanban-card";
    cardEl.textContent = card.title;
    document.getElementById(card.stage).appendChild(cardEl);
  });

  if (dataUrl) {
    fetch(dataUrl).then(r => r.json()).then(shared => {
      mergeShared(shared);
    });
  }
}

function mergeShared(shared) {
  const local = JSON.parse(localStorage.getItem("kanbanData") || `{"cards":[]}`);
  const merged = { cards: [...local.cards] };

  shared.cards.forEach(sc => {
    if (!local.cards.find(c => c.id === sc.id)) {
      merged.cards.push(sc);
    }
  });

  localStorage.setItem("kanbanData", JSON.stringify(merged));
  merged.cards.forEach(c => renderColumn(c));
}

function logout() {
  sessionStorage.removeItem("auth");
  window.location.href = "index.html";
}

function loadBoard() {
  const dataUrl = dataUrl ? `{\kanbanData}` : null;

  const merged = JSON.parse(localStorage.getItem("kanbanData") || `{"cards":[]}`);

  merged.cards.forEach(c => mergedColumn(c));
}

function newCard(stage) {
  const title = prompt("Titre de la carte :");
    if (!title) return;

    const data = JSON.parse(localStorage.getItem("kanbanData") || `{"cards":[]}`);

    const id = Date.now().toString();

    const card = { id, title, stage };

    data.cards.push(card);

    localStorage.setItem("kanbanData", JSON.stringify(data));
    cardList(JSON.stringify(data));

function saveToDrive() {
  const data = localStorage.getItem("kanbanData") || `{"cards":[]}`;
  alert("Ajoute maintenant ce JSON sur ton Drive Ã  l'emplacement partagÃ© ðŸ‘Œ\n\n" + data);
}

function renderColumn(sc) {
  const card = document.createElement("div");
  card.className = "kanban-card";
  card.textContent = stageColumn(cardEl);
  document.getElementById(sendToDrive()Input).appendChild(card);
}

</script>

</body>
</html>
